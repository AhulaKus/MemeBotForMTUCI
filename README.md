# Документация к проекту Meme Bot

## Описание проекта
Meme Bot — это проект Telegram-бот, который автоматизирует создание мемов. Бот может использовать базы данных, машинное обучение и другие инструменты для обработки пользовательских запросов, генерации изображений или текста, а также предоставления готовых мемов.

## Основные возможности
- **Работа с базой данных**: Подключение и взаимодействие с базой данных для хранения информации.
- **Машинное обучение**: Использование моделей для анализа данных или генерации контента.
- **Автоматизация через бота**: Реализация бота для общения с пользователями.
- **Конфигурируемость**: Поддержка настроек через файл `config.py`.

## Структура проекта

### Основные файлы и папки
- `main.py` — главный файл для запуска проекта.
- `config.py` — файл конфигурации с основными настройками.
- `requirements.txt` — список зависимостей Python, необходимых для работы проекта.
- `pyproject.toml` — файл конфигурации Python-проекта.
- `database.db` — база данных проекта.

### Директории

#### `app`
Содержит весь исходный код проекта:
- `bot/` — основная логика работы бота.
- `db/` — модули для работы с базой данных.
- `ml/` — модули, связанные с машинным обучением.
- `resources/` — вспомогательные ресурсы (например, шаблоны или данные).
- `utils/` — утилиты и вспомогательные функции.

## Установка
1. Убедитесь, что у вас установлен Python версии 3.8 или выше.
2. Установите зависимости из файла `requirements.txt`:
   ```bash
   pip install -r requirements.txt
   ```
3. Проверьте настройки в файле `config.py` и обновите их при необходимости.

## Запуск
Для запуска проекта выполните следующую команду:
```bash
python app/main.py
```
### Внимание!

Бот использует для генерации текста модели из фреймворка **Ollama**. Для корректной работы бота необходимо запустить модели **phi3** и **llava**. Пример, как это сделать локально приведен ниже.

1. Установка моделей
   ```bash
   ollama pull llava
   ```
   ```bash
   ollama pull llava
   ```

2. Запуск моделей
   ```bash
   ollama run phi3
   ````
   ```bash
   ollama run llava
   ````

## Для дальнейшего редактирования и краткое описание функций

### Настройка окружения
1. Создайте виртуальное окружение для проекта:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows: venv\Scripts\activate
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### Структура кода

#### Основные файлы:
- **`main.py`**: Точка входа в приложение. Отвечает за инициализацию бота и запуск основного цикла приложения.
- **`config.py`**: Содержит настройки проекта, включая параметры подключения к базе данных, ключи API и другие конфигурационные данные.

#### Директория `bot/`
Модули, отвечающие за взаимодействие с пользователями и обработку команд.

1. **`handlers.py`**:
   - `handle_start()`: Отвечает на команду `/start`, отправляя приветственное сообщение.
   - `handle_help()`: Обрабатывает команду `/help`, предоставляя пользователю список доступных команд.
   - `handle_generate_meme()`: Принимает пользовательский запрос на генерацию мема и передаёт параметры в соответствующий модуль.

2. **`commands.py`**:
   - `register_commands()`: Регистрация всех поддерживаемых команд в боте.
   - `execute_command(command, args)`: Выполняет указанную команду с переданными аргументами, вызывая соответствующую функцию.

3. **`utils.py`**:
   - `send_message(chat_id, text)`: Отправляет текстовое сообщение в заданный чат.
   - `send_photo(chat_id, photo_path)`: Отправляет изображение в заданный чат.
   - `log_error(error)`: Логирует ошибки, возникшие в процессе работы бота.

#### Директория `db/`
Отвечает за взаимодействие с базой данных.

1. **`database.py`**:
   - `initialize_db()`: Создаёт и инициализирует базу данных, если она ещё не существует.
   - `add_meme_record(user_id, meme_data)`: Сохраняет данные о сгенерированном меме в базу данных.
   - `get_user_history(user_id)`: Возвращает историю мемов, созданных конкретным пользователем.

2. **`queries.py`**:
   - Содержит готовые SQL-запросы для использования в приложении.

#### Директория `ml/`
Содержит модули для генерации мемов с использованием машинного обучения.

1. **`model.py`**:
   - `load_model()`: Загружает обученную модель для генерации изображений или текстов.
   - `generate_meme_text(input_data)`: Генерирует текст для мема на основе пользовательского ввода.
   - `generate_meme_image(input_data)`: Создаёт изображение мема с использованием модели.

2. **`preprocessing.py`**:
   - `prepare_input(data)`: Обрабатывает пользовательский ввод перед передачей в модель.
   - `postprocess_output(output)`: Форматирует результаты, полученные от модели, для использования в боте.

#### Директория `utils/`
Вспомогательные функции для проекта.

1. **`file_utils.py`**:
   - `save_image(image_data, path)`: Сохраняет изображение на диск.
   - `load_template(template_name)`: Загружает шаблон для мема из директории ресурсов.

2. **`logging.py`**:
   - `setup_logger()`: Настраивает систему логирования для приложения.

#### Директория `resources/`
Хранит статические файлы и картинки для мемов.

### Взаимодействие модулей
1. Пользователь отправляет запрос через бот (например, `напиши мем про...`).
2. **`handlers.py`** принимает запрос и вызывает соответствующую функцию из **`commands.py`**.
3. Если запрос связан с генерацией контента, он передаётся в модуль **`ml/`**, где данные обрабатываются и создаётся результат.
4. Сгенерированный контент передаётся в **`utils.py`** для отправки пользователю.
5. Если требуется сохранение данных, используется модуль **`db/database.py`**.